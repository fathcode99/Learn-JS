<script>
    let products = [
        {
            name : "Apel",
            price : 10000,
            stock : 5,
            sugarLevel : `Medium`,
            category : `Fruits`
        },

        {
            name : "French Fries",
            price : 15000,
            stock : 7,
            expired : 2022,
            category : `Fast Food`
        },

        {
            name : "Pants",
            price : 20000,
            stock : 9,
            size : `M`,
            category : `Pants`
        },

        {
            name : "Iron",
            price : 25000,
            stock : 11,
            warranty : true,
            category : `Electronic`
        }     
    ]

    let cart = []
    totalPrice = 0

    class Product {
        constructor(name, price, stock) {
            this.name = name,
            this.price = price,
            this.stock = stock
        }
    }
    
    class Fruit extends Product {
        constructor(name, price, stock, cate, sugar) {
            super(name, price, stock)
            this.sugarLevel = sugar
            this.category = cate
        }
    }

    class FastFood extends Product {
        constructor(name, price, stock, cate, exp) {
            super(name, price, stock)
            this.expired = exp
            this.category = cate
        }
    }

    class Cloth extends Product {
        constructor(name, price, stock, cate, size) {
            super(name, price, stock)
            this.size= size
            this.category = cate
        }
    }

    class Elect extends Product {
        constructor(name, price, stock, cate, warranty) {
            super(name, price, stock)
            this.warranty = warranty
            this.category = cate
        }
    }

    // function untuk menampilkan daftar buah

    // let showList = () => {
    //     let res = `Daftar Barang di Toserba : \n`
    //     products.forEach((item, index) => {
    //         res += `${index + 1}. ${item.name}, ${item.category} Rp ${item.price}. Stock = ${item.stock}, Sugar Level = ${item.sugarLevel} \n`
    //     })
    //     return res
    // }
    // let list = showList()
    // alert(list)

    // function untuk menampulkan daftar barang
    let showList = () => {
        let res = `Daftar Barang di Toserba : \n`
        products.forEach((item, index) => {
            let temp = `${index +1}. `
            for(let prop in item) {
                if(prop === `category`) {
                    temp += `${item[prop]}.`
                } else {
                    temp += `${item[prop]}, `
                }
            }
            res += temp + `\n`
        })
        return res
    }
    
    // function untuk menampilkan daftar barang di keranjang
    let showCart = () => {
        let res = `Daftar keranjang anda : \n`
        cart.forEach((item, index) => {
            res += `${index+1}. ${item.name} Rp ${item.price} x ${item.qty} = Rp ${item.price*item.qty}\n`
        })
        res += `Total Belanja Anda = Rp ${totalPrice}`

        return res
    }

    while (true) {
        let menuUtama = +prompt(`Selamat datang di Toserba :
        1. Daftar Barang
        2. Tambah Barang
        3. Hapus Barang
        4. Beli Barang
        5. Exit`)

        if (menuUtama == 1) {
            let list = showList()
            alert(list)
        } else if (menuUtama == 2) {
            while (true) {
                let idCate = +prompt(`Produk dengan kategori apa yang ingin di tambahkan ?
                1. Fruit
                2. Fast Food
                3. Cloth
                4. Electronik`)

                if (idCate === 1) {
                    let name = prompt(`Apa nama buahnya ?`)
                    let price = +prompt(`Berapa harganya?`)
                    let stock = +prompt(`Berapa stocknya ?`)
                    let sugar = prompt(`Bagaimana kadar gulanya? (Tulis Low, Medium atau High)`)

                    let buah = new Fruit(name, price, stock, `Fruit`, sugar)
                    products.push(buah)

                    alert(`Data barang ${name} sudah di tambahkan`)

                    let konfirmasi = confirm(`Mau tambah barang lagi ?`)
                    if(!konfirmasi) break

                } else if (idCate === 2) {
                    let name = prompt(`Apa nama makanan nya ?`)
                    let price = +prompt(`Berapa harganya?`)
                    let stock = +prompt(`Berapa stocknya ?`)
                    let exp = prompt(`Sampai tahun berapa tahun kadaluarsanya ?`)

                    let food = new FastFood(name, price, stock, `FastFood`, exp)
                    products.push(food)

                    alert(`Data barang ${name} sudah di tambahkan`)

                    let konfirmasi = confirm(`Mau tambah barang lagi ?`)
                    if(!konfirmasi) break
                } else if (idCate === 3) {
                    let name = prompt(`Apa jenis pakaiannya nya ?`)
                    let price = +prompt(`Berapa harganya?`)
                    let stock = +prompt(`Berapa stocknya ?`)
                    let size = prompt(`Berapak ukuran pakaiannya ? (M, L, XL, XXL`)

                    let cloth = new Cloth(name, price, stock, `Cloth`, size)
                    products.push(cloth)

                    alert(`Data barang ${name} sudah di tambahkan`)

                    let konfirmasi = confirm(`Mau tambah barang lagi ?`)
                    if(!konfirmasi) break
                    
                } else if (idCate === 4) {
                    let name = prompt(`Apa nama barangnya ?`)
                    let price = +prompt(`Berapa harganya?`)
                    let stock = +prompt(`Berapa stocknya ?`)
                    // let warranty = confirm(`Apakah barang ini ada garansinya`)
                    let warranty = prompt(`Apakah barang ini ada garansinya ? (Tulis True atau False)`)
                    if (warranty = `True`) {
                        warranty = true
                    } else if (warranty = `False`) {
                        warranty = false
                    }

                    let electronik = new Elect(name, price, stock, `Electronik`, warranty)
                    products.push(electronik)

                    alert(`Data barang ${name} sudah di tambahkan`)

                    let konfirmasi = confirm(`Mau tambah barang lagi ?`)
                    if(!konfirmasi) break
                } else {
                    alert(`Tolong input menu yang tersedia !`)
                }
            }
        } else if (menuUtama == 3) {
            let list = showList ()
            list += `Barang nomer berapa yang anda ingin hapus ?`

            let index = +prompt(list)
            products.splice(index-1, 1)

            alert(`Data barang ke ${index} sudah terhapus`)
        } else if (menuUtama == 4) {
            while (true) {
                let list = showList ()
                list += `Barang nomer berapa yang anda ingin beli ?`

                let indexBuy = +prompt(list)
                let qty = +prompt(`Berapa ${products[indexBuy-1].name} yang anda ingin beli ? *Stock = ${products[indexBuy].stock} `)
                
                while (true) {
                    if (qty > products[indexBuy].stock) {
                        alert(`Jumlah melebihi stock. Mohon input sesuai stock yang ada`)
                    } else if (qty <= products[indexBuy].stock) {
                        let ind = null
                        cart.forEach((item, indexCart) => {
                            if (item.name === products[indexBuy-1].name) {
                                ind = indexCart
                            }
                        })
                        
                        if (ind === null) {
                            cart.push ({
                                name : products[indexBuy-1].name,
                                price : products[indexBuy-1].price,
                                qty
                            })
                        } else {
                            let temp = cart[ind].qty + qty
                            cart[ind].qty = temp
                        }

                        // untuk menghitung total price
                        let count = 0
                        cart.forEach(item => {
                            count += item.price * item.qty
                        })

                        totalPrice = count
                        alert(`Barang ${products[indexBuy-1].name} sudah di tambahkan ke keranjang`)
        
                        keranjang = showCart()
                        alert(keranjang)
                        // break

                    }

                    // konfirmasi apakah ingin membeli buah lagi 
                    let konfirmasi = confirm(`Apakah anda mau membeli buah yg lain ?`)
                        
                    // kalau tidak maka looping pembelian buah akan berhenti, dan lanjut ke proses payment
                    if (!konfirmasi) break
                }
            }
            while (true) {
                keranjang = showCart()
                keranjang += `Tolong input nominal pembayaran`
    
                let nominal = +prompt(keranjang)

                if (nominal < totalPrice) {
                    // kalau uang kurang
                    alert(`Tolong input nilai yang sesuai dengan pembayaran`)
                } else if (nominal == totalPrice) {
                    // kalau uang pas
                    alert(`Terimakasih`)
                    break
                    cart = []
                } else if (nominal > totalPrice) {
                    // kalau uang berlebih
                    alert(`Terimakasih. Uang kembalian anda Rp ${(nominal-totalPrice).toLocaleString()}
                    Pesanan akan segera diantar`)
                    break
                    cart = []
                }
            }
        } else if (menuUtama == 5) {
            alert(`Terimakasih. Silahkan datang kembali !`)
            break
        } else {
            alert(`Menu tidak tersedia`)
        }
    }
</script>
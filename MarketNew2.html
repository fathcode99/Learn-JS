<script>
    let fruits = [[`Apel`, 10000, 5], [`Anggur`, 10000, 5], [`Jeruk`, 10000, 5]]
    let cart = []
    totalPrice = 0

    while (true) {
        let menuUtama = +prompt(`Selamat datang di Toko Buah Fresh :
        1. Daftar Buah
        2. Tambah Buah
        3. Hapus Buah
        4. Beli Buah
        5. Exit`)

        if (menuUtama == 1) {
            // console.log(1)
            let list = `Daftar Buah yang tersedia : \n`
            for (i=0; i<fruits.length; i++) {
                list += `${i + 1}. ${fruits[i][0]} = Rp ${fruits[i][1]} / buah. Stock = ${fruits[i][2]} \n`
            }
            alert(list)
        } else if (menuUtama == 2) {
            // console.log(2)
            let newData = []
            let name

            while (true) {
                let nameInput = prompt(`Input nama buah`)
                if (!nameInput) {
                    alert(`Tolong input yang benar`)
                } else {
                    newData.push(nameInput)
                    break
                }
            }
            while (true) {
                let price = +prompt(`Input harga buah`)
                if (!price) {
                    alert(`Tolong input yang benar`)
                } else {
                    newData.push(price)
                    break
                } 
            }
            while (true) {
                let stock = +prompt(`Input stock buah`)
                if (!stock) {
                    alert(`Tolong input yang benar`)
                } else {
                    newData.push(stock)
                    break
                } 

            fruits.push(newData)
            alert(`Data buah ${name} teah di masukan ke database`)

            }
        } else if (menuUtama == 3) {
            // console.log(3)
            let list = `Daftar Buah yang tersedia : \n`
            for (i=0; i<fruits.length; i++) {
                list += `${i + 1}. ${fruits[i][0]} = Rp ${fruits[i][1]} / buah. Stock = ${fruits[i][2]} \n`
            }
            list += `Buah nomer berapa yang ingin anda hapus ?`

            let index = +prompt(list)
            fruits.splice(index-1, 1)

            alert(`Data buah ke ${index} sudah terhapus dari database`)

        } else if (menuUtama ==4) {
            // console.log(4)
            // while ini adalah looping besar untuk membeli buah 
            while(true) {
                // menampilkan daftar buah yang tersedia meminta user untuk meminta buah mana yang akan di beli
                let list = `Daftar Buah yang tersedia : \n`
                for (i=0; i<fruits.length; i++) {
                    list += `${i + 1}. ${fruits[i][0]} = Rp ${fruits[i][1]} / buah. Stock = ${fruits[i][2]} \n`
                }
                list += `Buah nomer berapa yang ingin anda beli ?`
                
                let index = +prompt(list)
                
                while (true) {
                    // minta user untuk menentukan qty buah pembelian product
                    let qty = +prompt(`Berapa ${fruits[index - 1][0]} yang anda ingin beli ? *Stock = ${fruits[index - 1][2]} `)
                    
                    if (qty > fruits[index - 1][2]) {
                        // kalau qty melebih stock akan muncul alert ini, kemudian meminta lagi meminta qty yg benar
                        alert(`Quantity melebihi stock produk, mohon input sesuai stok yang ada`)
                    } else if (qty <= fruits[index - 1][2]) {
                        // kalau qty sesuai stock data buah di masukkan ke dalam cart
                        // jika data sudah ada maka quantitas nya akan di tambahkan dan tidak mempush data baru

                        // cek apakah ada data yagn sama di cart 
                        let ind = null
                        for (let i =0; i<cart.length; i++) {
                            if (cart[i][0] === fruits[index-1][0]) {
                                ind = i 
                            }
                        }                    
                        if (ind === null) {
                            cart.push([fruits[index-1][0], fruits[index-1][1], qty])
                        } else {
                            let temp = cart[ind][2] + qty
                            cart[ind][2] = temp
                        }
                        
                        
                        // untuk menghitung total price alternatif 1
                        // totalPrice += fruits[index - 1][1] * qty

                        // untuk menghitung total price alternatif 2
                        let count = 0
                        for(let i = 0 ; i < cart.length ; i++) {
                            count += cart[i][1] * cart[i][2]
                        }
                        totalPrice = count


                        alert(`Buah ${fruits[index -1][0]} sudah di masukan ke dalam keranjang`)

                        //  setiap berhasil menambahkan barang ke cart, maka akan muncul list cart sementara
                        let keranjang = `Daftar keranjang anda : \n`
                        for (let i = 0 ; i < cart.length; i++) {
                            keranjang += `${i+1}. ${cart[i][0]} Rp ${cart[i][1]} x ${cart[i][2]} = Rp ${cart[i][1]*cart[i][2]} \n`
                        }
                        keranjang += `Total Belanja Anda = Rp ${totalPrice}`

                        alert(keranjang)
                        break
                    }
                }
                // konfirmasi apakah ingin membeli buah lagi 
                let konfirmasi = confirm(`Apakah anda mau membeli buah yg lain ?`)
                
                // kalau tidak maka looping pembelian buah akan berhenti, dan lanjut ke proses payment
                if (!konfirmasi) break
                
            }
            while (true) {
                // untuk mengisi nominal pembayaran
                let keranjang = `Daftar keranjang anda : \n`
                for (let i = 0 ; i < cart.length; i++) {
                    keranjang += `${i+1}. ${cart[i][0]} Rp ${cart[i][1]} x ${cart[i][2]} = Rp ${cart[i][1]*cart[i][2]} \n`
                }
                keranjang += `Total Belanja Anda = Rp ${totalPrice}. \nTolong input nominal pembayaran`
    
                let nominal = +prompt(keranjang)

                if (nominal < totalPrice) {
                    // kalau uang kurang
                    alert(`Tolong input nilai yang sesuai dengan pembayaran`)
                } else if (nominal == totalPrice) {
                    // kalau uang pas
                    alert(`Terimakasih`)
                    break
                } else if (nominal > totalPrice) {
                    // kalau uang berlebih
                    alert(`Terimakasih. Uang kembalian anda Rp ${(nominal-totalPrice).toLocaleString()}\nPesanan akan segera diantar`)
                    break
                }
            }
        } else if (menuUtama == 5) {
            alert(`Terimakasih. Silahkan datang kembali !`)
            break
        } else {
            alert(`Menu tidak tersedia`)
        }
    }
</script>